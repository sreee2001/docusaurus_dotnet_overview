"use strict";(self.webpackChunkdotnet_overview=self.webpackChunkdotnet_overview||[]).push([[8757],{8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var t=r(6540);const i={},s=t.createContext(i);function o(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(s.Provider,{value:n},e.children)}},8850:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"Topics/DevOps_and_CI_CD/ApplicationInsights","title":"Application Insights (Observability + Instrumentation)","description":"Short Introduction","source":"@site/docs/Topics/09_DevOps_and_CI_CD/42_ApplicationInsights.md","sourceDirName":"Topics/09_DevOps_and_CI_CD","slug":"/Topics/DevOps_and_CI_CD/application_insights","permalink":"/docusaurus_dotnet_overview/docs/Topics/DevOps_and_CI_CD/application_insights","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"dotnet","permalink":"/docusaurus_dotnet_overview/docs/tags/dotnet"},{"inline":true,"label":"application","permalink":"/docusaurus_dotnet_overview/docs/tags/application"},{"inline":true,"label":"insights","permalink":"/docusaurus_dotnet_overview/docs/tags/insights"},{"inline":true,"label":"observability","permalink":"/docusaurus_dotnet_overview/docs/tags/observability"},{"inline":true,"label":"instrumentation","permalink":"/docusaurus_dotnet_overview/docs/tags/instrumentation"},{"inline":true,"label":"APM","permalink":"/docusaurus_dotnet_overview/docs/tags/apm"},{"inline":true,"label":"service","permalink":"/docusaurus_dotnet_overview/docs/tags/service"},{"inline":true,"label":"metrics","permalink":"/docusaurus_dotnet_overview/docs/tags/metrics"}],"version":"current","sidebarPosition":42,"frontMatter":{"slug":"application_insights","title":"Application Insights (Observability + Instrumentation)","tags":["dotnet","application","insights","observability","instrumentation","APM","service","metrics"]},"sidebar":"tutorialSidebar","previous":{"title":"GitHub Actions","permalink":"/docusaurus_dotnet_overview/docs/Topics/DevOps_and_CI_CD/github_actions"},"next":{"title":"HealthChecks","permalink":"/docusaurus_dotnet_overview/docs/Topics/DevOps_and_CI_CD/HealthChecks"}}');var i=r(4848),s=r(8453);const o={slug:"application_insights",title:"Application Insights (Observability + Instrumentation)",tags:["dotnet","application","insights","observability","instrumentation","APM","service","metrics"]},a="Application Insights (Observability + Instrumentation)",l={},c=[{value:"Short Introduction",id:"short-introduction",level:2},{value:"Official Definition",id:"official-definition",level:2},{value:"Setup and Deployment",id:"setup-and-deployment",level:2},{value:"Azure CLI Setup",id:"azure-cli-setup",level:3},{value:"Bicep Template",id:"bicep-template",level:3},{value:"Minimal Sample: Deploy ASP.NET Core App to App Service with Application Insights",id:"minimal-sample-deploy-aspnet-core-app-to-app-service-with-application-insights",level:3},{value:"Typical Usage and Integration with .NET Apps",id:"typical-usage-and-integration-with-net-apps",level:2},{value:"NuGet Packages",id:"nuget-packages",level:3},{value:"Basic Configuration",id:"basic-configuration",level:3},{value:"Program.cs Configuration",id:"programcs-configuration",level:3},{value:"Advanced Telemetry Collection",id:"advanced-telemetry-collection",level:2},{value:"Custom Telemetry Tracking Service",id:"custom-telemetry-tracking-service",level:3},{value:"Example 1: Controller Integration",id:"example-1-controller-integration",level:3},{value:"Example 2: Orders Controller",id:"example-2-orders-controller",level:3},{value:"Custom Telemetry Middleware",id:"custom-telemetry-middleware",level:2},{value:"Structured Logging Integration",id:"structured-logging-integration",level:2},{value:"Health Checks Integration",id:"health-checks-integration",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"When to Use vs When Not to Use",id:"when-to-use-vs-when-not-to-use",level:2},{value:"Use Application Insights when",id:"use-application-insights-when",level:3},{value:"Don&#39;t use when",id:"dont-use-when",level:3},{value:"Market Alternatives &amp; Pros/Cons",id:"market-alternatives--proscons",level:2},{value:"Alternatives",id:"alternatives",level:3},{value:"Pros",id:"pros",level:3},{value:"Cons",id:"cons",level:3},{value:"Cost Considerations",id:"cost-considerations",level:3},{value:"Kusto Queries for Analysis",id:"kusto-queries-for-analysis",level:2}];function p(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"application-insights-observability--instrumentation",children:"Application Insights (Observability + Instrumentation)"})}),"\n",(0,i.jsx)(n.h2,{id:"short-introduction",children:"Short Introduction"}),"\n",(0,i.jsx)(n.p,{children:"Application Insights is Azure's application performance management (APM) service that provides real-time monitoring, diagnostics, and analytics for .NET applications. It automatically collects telemetry data including requests, dependencies, exceptions, and custom metrics, enabling developers to detect issues, optimize performance, and understand user behavior."}),"\n",(0,i.jsx)(n.h2,{id:"official-definition",children:"Official Definition"}),"\n",(0,i.jsx)(n.p,{children:'"Application Insights, a feature of Azure Monitor, is an extensible Application Performance Management (APM) service for developers and DevOps professionals. Use it to monitor your live applications automatically."'}),"\n",(0,i.jsx)(n.p,{children:"Application Insights is a feature of Azure Monitor that provides extensible application performance management (APM) and monitoring for live web applications. It works for apps on a wide variety of platforms including .NET, Node.js, Java, and Python hosted on-premises, hybrid, or any public cloud."}),"\n",(0,i.jsx)(n.h2,{id:"setup-and-deployment",children:"Setup and Deployment"}),"\n",(0,i.jsx)(n.h3,{id:"azure-cli-setup",children:"Azure CLI Setup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Create Application Insights resource\r\naz monitor app-insights component create --app myapp --location eastus --resource-group myResourceGroup --application-type web\r\n\r\n# Get instrumentation key\r\naz monitor app-insights component show --app myapp --resource-group myResourceGroup --query instrumentationKey\n"})}),"\n",(0,i.jsx)(n.h3,{id:"bicep-template",children:"Bicep Template"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bicep",children:"resource appInsights 'Microsoft.Insights/components@2020-02-02' = {\r\n  name: 'myapp-insights'\r\n  location: resourceGroup().location\r\n  kind: 'web'\r\n  properties: {\r\n    Application_Type: 'web'\r\n    Flow_Type: 'Bluefield'\r\n    Request_Source: 'rest'\r\n  }\r\n}\r\n\r\noutput instrumentationKey string = appInsights.properties.InstrumentationKey\r\noutput connectionString string = appInsights.properties.ConnectionString\n"})}),"\n",(0,i.jsx)(n.h3,{id:"minimal-sample-deploy-aspnet-core-app-to-app-service-with-application-insights",children:"Minimal Sample: Deploy ASP.NET Core App to App Service with Application Insights"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Variables\r\nRESOURCE_GROUP="hotel-demo-rg"\r\nAPP_NAME="hotel-api-$(date +%s)"\r\nLOCATION="eastus"\r\nAPP_SERVICE_PLAN="hotel-plan"\r\n\r\n# Create resource group\r\naz group create --name $RESOURCE_GROUP --location $LOCATION\r\n\r\n# Create App Service plan\r\naz appservice plan create --name $APP_SERVICE_PLAN --resource-group $RESOURCE_GROUP --sku B1\r\n\r\n# Create Application Insights\r\naz monitor app-insights component create \\\r\n    --app $APP_NAME-insights \\\r\n    --location $LOCATION \\\r\n    --resource-group $RESOURCE_GROUP \\\r\n    --application-type web\r\n\r\n# Get Application Insights connection string\r\nINSIGHTS_CONNECTION=$(az monitor app-insights component show \\\r\n    --app $APP_NAME-insights \\\r\n    --resource-group $RESOURCE_GROUP \\\r\n    --query connectionString -o tsv)\r\n\r\n# Create web app\r\naz webapp create \\\r\n    --resource-group $RESOURCE_GROUP \\\r\n    --plan $APP_SERVICE_PLAN \\\r\n    --name $APP_NAME \\\r\n    --runtime "DOTNET|8.0"\r\n\r\n# Configure Application Insights\r\naz webapp config appsettings set \\\r\n    --resource-group $RESOURCE_GROUP \\\r\n    --name $APP_NAME \\\r\n    --settings "APPLICATIONINSIGHTS_CONNECTION_STRING=$INSIGHTS_CONNECTION"\r\n\r\n# Deploy app (assuming you have a zip package)\r\n# az webapp deployment source config-zip --resource-group $RESOURCE_GROUP --name $APP_NAME --src app.zip\r\n\r\necho "App deployed to: https://$APP_NAME.azurewebsites.net"\r\necho "Application Insights: https://portal.azure.com/#@/resource/subscriptions/.../resourceGroups/$RESOURCE_GROUP/providers/Microsoft.Insights/components/$APP_NAME-insights"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"typical-usage-and-integration-with-net-apps",children:"Typical Usage and Integration with .NET Apps"}),"\n",(0,i.jsx)(n.h3,{id:"nuget-packages",children:"NuGet Packages"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"dotnet add package Microsoft.ApplicationInsights.AspNetCore\r\ndotnet add package Microsoft.ApplicationInsights.PerfCounterCollector\r\ndotnet add package Microsoft.ApplicationInsights.EventCounterCollector\n"})}),"\n",(0,i.jsx)(n.h3,{id:"basic-configuration",children:"Basic Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'// appsettings.json\r\n{\r\n  "ApplicationInsights": {\r\n    "ConnectionString": "InstrumentationKey=your-instrumentation-key;IngestionEndpoint=https://your-region.in.applicationinsights.azure.com/",\r\n    "EnableAdaptiveSampling": true,\r\n    "EnableQuickPulseMetricStream": true,\r\n    "EnableAuthenticationTrackingJavaScript": true\r\n  },\r\n  "Logging": {\r\n    "LogLevel": {\r\n      "Default": "Information",\r\n      "Microsoft": "Warning",\r\n      "Microsoft.Hosting.Lifetime": "Information"\r\n    },\r\n    "ApplicationInsights": {\r\n      "LogLevel": {\r\n        "Default": "Information",\r\n        "Microsoft": "Warning"\r\n      }\r\n    }\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"programcs-configuration",children:"Program.cs Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using Microsoft.ApplicationInsights.Extensibility;\r\n\r\nvar builder = WebApplication.CreateBuilder(args);\r\n\r\n// Add Application Insights\r\nbuilder.Services.AddApplicationInsightsTelemetry(options =>\r\n{\r\n    options.ConnectionString = builder.Configuration.GetConnectionString("ApplicationInsights");\r\n    options.EnableAdaptiveSampling = true;\r\n    options.EnableQuickPulseMetricStream = true;\r\n    options.EnableAuthenticationTrackingJavaScript = true;\r\n});\r\n\r\n// Add custom telemetry initializers\r\nbuilder.Services.AddSingleton<ITelemetryInitializer, CustomTelemetryInitializer>();\r\n\r\n// Add telemetry processors\r\nbuilder.Services.AddApplicationInsightsTelemetryProcessor<CustomTelemetryProcessor>();\r\n\r\nvar app = builder.Build();\r\n\r\n// Enable Application Insights middleware\r\napp.UseApplicationInsightsRequestTelemetry();\r\n\r\napp.MapControllers();\r\napp.Run();\r\n\r\n// Custom Telemetry Initializer\r\npublic class CustomTelemetryInitializer : ITelemetryInitializer\r\n{\r\n    public void Initialize(ITelemetry telemetry)\r\n    {\r\n        telemetry.Context.Cloud.RoleName = "HotelManagement.API";\r\n        telemetry.Context.Component.Version = "1.0.0";\r\n\r\n        // Add custom properties\r\n        if (telemetry is ISupportProperties supportProperties)\r\n        {\r\n            supportProperties.Properties["Environment"] = Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT") ?? "Unknown";\r\n            supportProperties.Properties["MachineName"] = Environment.MachineName;\r\n        }\r\n    }\r\n}\r\n\r\n// Custom Telemetry Processor\r\npublic class CustomTelemetryProcessor : ITelemetryProcessor\r\n{\r\n    private ITelemetryProcessor Next { get; set; }\r\n\r\n    public CustomTelemetryProcessor(ITelemetryProcessor next)\r\n    {\r\n        Next = next;\r\n    }\r\n\r\n    public void Process(ITelemetry item)\r\n    {\r\n        // Filter out health check requests\r\n        if (item is RequestTelemetry request &&\r\n            request.Url?.AbsolutePath?.Contains("/health") == true)\r\n        {\r\n            return; // Don\'t process health check requests\r\n        }\r\n\r\n        // Add custom logic here\r\n        if (item is DependencyTelemetry dependency)\r\n        {\r\n            // Mask sensitive data in SQL commands\r\n            if (dependency.Type == "SQL" && !string.IsNullOrEmpty(dependency.Data))\r\n            {\r\n                dependency.Data = MaskSensitiveData(dependency.Data);\r\n            }\r\n        }\r\n\r\n        Next.Process(item);\r\n    }\r\n\r\n    private string MaskSensitiveData(string data)\r\n    {\r\n        // Implement your masking logic here\r\n        return data.Replace("password", "***");\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"advanced-telemetry-collection",children:"Advanced Telemetry Collection"}),"\n",(0,i.jsx)(n.h3,{id:"custom-telemetry-tracking-service",children:"Custom Telemetry Tracking Service"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'// Services/TelemetryService.cs\r\npublic class TelemetryService\r\n{\r\n    private readonly TelemetryClient _telemetryClient;\r\n    private readonly ILogger<TelemetryService> _logger;\r\n\r\n    public TelemetryService(TelemetryClient telemetryClient, ILogger<TelemetryService> logger)\r\n    {\r\n        _telemetryClient = telemetryClient;\r\n        _logger = logger;\r\n    }\r\n\r\n    public void TrackCustomEvent(string eventName, Dictionary<string, string> properties = null, Dictionary<string, double> metrics = null)\r\n    {\r\n        _telemetryClient.TrackEvent(eventName, properties, metrics);\r\n    }\r\n\r\n    public void TrackBusinessMetric(string metricName, double value, Dictionary<string, string> properties = null)\r\n    {\r\n        _telemetryClient.TrackMetric(metricName, value, properties);\r\n    }\r\n\r\n    public void TrackUserAction(string actionName, string userId, Dictionary<string, string> additionalProperties = null)\r\n    {\r\n        var properties = new Dictionary<string, string>\r\n        {\r\n            ["UserId"] = userId,\r\n            ["Action"] = actionName,\r\n            ["Timestamp"] = DateTime.UtcNow.ToString("O")\r\n        };\r\n\r\n        if (additionalProperties != null)\r\n        {\r\n            foreach (var prop in additionalProperties)\r\n            {\r\n                properties[prop.Key] = prop.Value;\r\n            }\r\n        }\r\n\r\n        _telemetryClient.TrackEvent("UserAction", properties);\r\n    }\r\n\r\n    public IDisposable StartOperation(string operationName)\r\n    {\r\n        return _telemetryClient.StartOperation<RequestTelemetry>(operationName);\r\n    }\r\n\r\n    public void TrackDependency(string dependencyType, string target, string dependencyName,\r\n        DateTime startTime, TimeSpan duration, bool success)\r\n    {\r\n        _telemetryClient.TrackDependency(dependencyType, target, dependencyName,\r\n            startTime, duration, success);\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"example-1-controller-integration",children:"Example 1: Controller Integration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'[ApiController]\r\n[Route("api/[controller]")]\r\npublic class BookingController : ControllerBase\r\n{\r\n    private readonly IBookingService _bookingService;\r\n    private readonly TelemetryService _telemetryService;\r\n\r\n    public BookingController(IBookingService bookingService, TelemetryService telemetryService)\r\n    {\r\n        _bookingService = bookingService;\r\n        _telemetryService = telemetryService;\r\n    }\r\n\r\n    [HttpPost]\r\n    public async Task<IActionResult> CreateBooking([FromBody] CreateBookingRequest request)\r\n    {\r\n        using var operation = _telemetryService.StartOperation("CreateBooking");\r\n\r\n        try\r\n        {\r\n            var booking = await _bookingService.CreateAsync(request);\r\n\r\n            // Track business metrics\r\n            _telemetryService.TrackBusinessMetric("BookingsCreated", 1, new Dictionary<string, string>\r\n            {\r\n                ["RoomType"] = request.RoomType,\r\n                ["Duration"] = (request.CheckOut - request.CheckIn).TotalDays.ToString()\r\n            });\r\n\r\n            // Track user action\r\n            _telemetryService.TrackUserAction("CreateBooking", request.CustomerId, new Dictionary<string, string>\r\n            {\r\n                ["BookingId"] = booking.Id.ToString(),\r\n                ["RoomType"] = request.RoomType\r\n            });\r\n\r\n            return Ok(booking);\r\n        }\r\n        catch (Exception ex)\r\n        {\r\n            _telemetryService.TrackCustomEvent("BookingCreationFailed", new Dictionary<string, string>\r\n            {\r\n                ["Error"] = ex.Message,\r\n                ["CustomerId"] = request.CustomerId\r\n            });\r\n\r\n            throw;\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"example-2-orders-controller",children:"Example 2: Orders Controller"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'[ApiController]\r\n[Route("api/[controller]")]\r\npublic class OrdersController : ControllerBase\r\n{\r\n    private readonly TelemetryClient _telemetryClient;\r\n    private readonly ILogger<OrdersController> _logger;\r\n\r\n    public OrdersController(TelemetryClient telemetryClient, ILogger<OrdersController> logger)\r\n    {\r\n        _telemetryClient = telemetryClient;\r\n        _logger = logger;\r\n    }\r\n\r\n    [HttpPost]\r\n    public async Task<IActionResult> CreateOrder([FromBody] CreateOrderRequest request)\r\n    {\r\n        using var operation = _telemetryClient.StartOperation<RequestTelemetry>("CreateOrder");\r\n\r\n        try\r\n        {\r\n            // Add custom properties\r\n            _telemetryClient.TrackEvent("OrderCreationStarted", new Dictionary<string, string>\r\n            {\r\n                ["CustomerId"] = request.CustomerId.ToString(),\r\n                ["OrderValue"] = request.TotalAmount.ToString("C")\r\n            });\r\n\r\n            // Track custom metrics\r\n            _telemetryClient.TrackMetric("OrderValue", request.TotalAmount);\r\n\r\n            // Simulate order processing\r\n            var stopwatch = Stopwatch.StartNew();\r\n            await ProcessOrderAsync(request);\r\n            stopwatch.Stop();\r\n\r\n            // Track dependency call\r\n            _telemetryClient.TrackDependency("Database", "CreateOrder",\r\n                DateTime.UtcNow.Subtract(stopwatch.Elapsed), stopwatch.Elapsed, true);\r\n\r\n            _telemetryClient.TrackEvent("OrderCreated", new Dictionary<string, string>\r\n            {\r\n                ["OrderId"] = "12345",\r\n                ["ProcessingTimeMs"] = stopwatch.ElapsedMilliseconds.ToString()\r\n            });\r\n\r\n            return Ok(new { OrderId = 12345 });\r\n        }\r\n        catch (Exception ex)\r\n        {\r\n            _telemetryClient.TrackException(ex, new Dictionary<string, string>\r\n            {\r\n                ["CustomerId"] = request.CustomerId.ToString(),\r\n                ["Operation"] = "CreateOrder"\r\n            });\r\n\r\n            _logger.LogError(ex, "Failed to create order for customer {CustomerId}", request.CustomerId);\r\n            return StatusCode(500, "Order creation failed");\r\n        }\r\n    }\r\n\r\n    private async Task ProcessOrderAsync(CreateOrderRequest request)\r\n    {\r\n        // Simulate processing time\r\n        await Task.Delay(Random.Shared.Next(100, 500));\r\n\r\n        // Simulate occasional errors\r\n        if (Random.Shared.NextDouble() < 0.1)\r\n        {\r\n            throw new InvalidOperationException("Simulated order processing error");\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"custom-telemetry-middleware",children:"Custom Telemetry Middleware"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'public class ApplicationInsightsMiddleware\r\n{\r\n    private readonly RequestDelegate _next;\r\n    private readonly TelemetryClient _telemetryClient;\r\n\r\n    public ApplicationInsightsMiddleware(RequestDelegate next, TelemetryClient telemetryClient)\r\n    {\r\n        _next = next;\r\n        _telemetryClient = telemetryClient;\r\n    }\r\n\r\n    public async Task InvokeAsync(HttpContext context)\r\n    {\r\n        var startTime = DateTime.UtcNow;\r\n        var stopwatch = Stopwatch.StartNew();\r\n\r\n        try\r\n        {\r\n            await _next(context);\r\n        }\r\n        finally\r\n        {\r\n            stopwatch.Stop();\r\n\r\n            // Track custom request telemetry\r\n            var telemetry = new RequestTelemetry\r\n            {\r\n                Name = $"{context.Request.Method} {context.Request.Path}",\r\n                Url = new Uri($"{context.Request.Scheme}://{context.Request.Host}{context.Request.Path}{context.Request.QueryString}"),\r\n                Timestamp = startTime,\r\n                Duration = stopwatch.Elapsed,\r\n                ResponseCode = context.Response.StatusCode.ToString(),\r\n                Success = context.Response.StatusCode < 400\r\n            };\r\n\r\n            // Add custom properties\r\n            telemetry.Properties["UserAgent"] = context.Request.Headers["User-Agent"].ToString();\r\n            telemetry.Properties["ClientIP"] = context.Connection.RemoteIpAddress?.ToString();\r\n\r\n            _telemetryClient.TrackRequest(telemetry);\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"structured-logging-integration",children:"Structured Logging Integration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'public class ProductService\r\n{\r\n    private readonly ILogger<ProductService> _logger;\r\n    private readonly TelemetryClient _telemetryClient;\r\n\r\n    public ProductService(ILogger<ProductService> logger, TelemetryClient telemetryClient)\r\n    {\r\n        _logger = logger;\r\n        _telemetryClient = telemetryClient;\r\n    }\r\n\r\n    public async Task<Product> GetProductAsync(int productId)\r\n    {\r\n        using (_logger.BeginScope(new Dictionary<string, object> { ["ProductId"] = productId }))\r\n        {\r\n            _logger.LogInformation("Retrieving product {ProductId}", productId);\r\n\r\n            var stopwatch = Stopwatch.StartNew();\r\n\r\n            try\r\n            {\r\n                // Simulate database call\r\n                await Task.Delay(Random.Shared.Next(50, 200));\r\n\r\n                var product = new Product { Id = productId, Name = $"Product {productId}" };\r\n\r\n                _logger.LogInformation("Successfully retrieved product {ProductId} in {ElapsedMs}ms",\r\n                    productId, stopwatch.ElapsedMilliseconds);\r\n\r\n                return product;\r\n            }\r\n            catch (Exception ex)\r\n            {\r\n                _logger.LogError(ex, "Failed to retrieve product {ProductId}", productId);\r\n                throw;\r\n            }\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"health-checks-integration",children:"Health Checks Integration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'// Program.cs\r\nbuilder.Services.AddHealthChecks()\r\n    .AddApplicationInsightsPublisher();\r\n\r\n// Custom health check\r\npublic class DatabaseHealthCheck : IHealthCheck\r\n{\r\n    private readonly ILogger<DatabaseHealthCheck> _logger;\r\n\r\n    public DatabaseHealthCheck(ILogger<DatabaseHealthCheck> logger)\r\n    {\r\n        _logger = logger;\r\n    }\r\n\r\n    public async Task<HealthCheckResult> CheckHealthAsync(HealthCheckContext context,\r\n        CancellationToken cancellationToken = default)\r\n    {\r\n        try\r\n        {\r\n            // Simulate database connectivity check\r\n            await Task.Delay(100, cancellationToken);\r\n\r\n            _logger.LogInformation("Database health check passed");\r\n            return HealthCheckResult.Healthy("Database is responsive");\r\n        }\r\n        catch (Exception ex)\r\n        {\r\n            _logger.LogError(ex, "Database health check failed");\r\n            return HealthCheckResult.Unhealthy("Database is not responsive", ex);\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Application performance monitoring and optimization"}),"\n",(0,i.jsx)(n.li,{children:"Error tracking and exception analysis"}),"\n",(0,i.jsx)(n.li,{children:"User behavior analytics and usage patterns"}),"\n",(0,i.jsx)(n.li,{children:"Infrastructure monitoring and dependency tracking"}),"\n",(0,i.jsx)(n.li,{children:"Real-time alerting on performance issues"}),"\n",(0,i.jsx)(n.li,{children:"A/B testing and feature flag monitoring"}),"\n",(0,i.jsx)(n.li,{children:"Business intelligence and custom metrics"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"when-to-use-vs-when-not-to-use",children:"When to Use vs When Not to Use"}),"\n",(0,i.jsx)(n.h3,{id:"use-application-insights-when",children:"Use Application Insights when"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Azure-hosted applications requiring deep integration"}),"\n",(0,i.jsx)(n.li,{children:"Comprehensive APM solution needed"}),"\n",(0,i.jsx)(n.li,{children:"Integration with Azure Monitor ecosystem important"}),"\n",(0,i.jsx)(n.li,{children:"Built-in analytics and alerting capabilities desired"}),"\n",(0,i.jsx)(n.li,{children:"Automatic instrumentation for common frameworks preferred"}),"\n",(0,i.jsx)(n.li,{children:"Building production applications requiring monitoring"}),"\n",(0,i.jsx)(n.li,{children:"Need automated alerting and diagnostics"}),"\n",(0,i.jsx)(n.li,{children:"Building business-critical applications"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"dont-use-when",children:"Don't use when"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Multi-cloud monitoring strategy required"}),"\n",(0,i.jsx)(n.li,{children:"Cost optimization for simple monitoring needs"}),"\n",(0,i.jsx)(n.li,{children:"Existing monitoring infrastructure in place"}),"\n",(0,i.jsx)(n.li,{children:"Real-time streaming analytics primary requirement"}),"\n",(0,i.jsx)(n.li,{children:"Working primarily with non-Azure infrastructure"}),"\n",(0,i.jsx)(n.li,{children:"Need open-source monitoring solutions"}),"\n",(0,i.jsx)(n.li,{children:"Budget constraints for high-volume applications"}),"\n",(0,i.jsx)(n.li,{children:"Simple applications with minimal monitoring needs"}),"\n",(0,i.jsx)(n.li,{children:"Strict data residency requirements outside Azure regions"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"market-alternatives--proscons",children:"Market Alternatives & Pros/Cons"}),"\n",(0,i.jsx)(n.h3,{id:"alternatives",children:"Alternatives"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Azure"}),": Azure Monitor Logs, Azure Monitor Metrics"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"AWS"}),": CloudWatch, X-Ray"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"GCP"}),": Cloud Monitoring, Cloud Trace"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Open Source"}),": Prometheus + Grafana, Jaeger, Zipkin, Elastic APM"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Commercial"}),": New Relic, Datadog, Dynatrace"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"pros",children:"Pros"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Deep integration with Azure services"}),"\n",(0,i.jsx)(n.li,{children:"Automatic instrumentation for ASP.NET Core applications"}),"\n",(0,i.jsx)(n.li,{children:"Rich analytics and query capabilities (KQL)"}),"\n",(0,i.jsx)(n.li,{children:"Integration with Azure DevOps and GitHub"}),"\n",(0,i.jsx)(n.li,{children:"Smart detection of performance anomalies"}),"\n",(0,i.jsx)(n.li,{children:"Comprehensive dependency mapping"}),"\n",(0,i.jsx)(n.li,{children:"Built-in alerting and dashboards"}),"\n",(0,i.jsx)(n.li,{children:"Live metrics streaming"}),"\n",(0,i.jsx)(n.li,{children:"Excellent .NET Core integration"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"cons",children:"Cons"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Can be expensive for high-volume applications"}),"\n",(0,i.jsx)(n.li,{children:"Data stored in Azure (potential compliance issues)"}),"\n",(0,i.jsx)(n.li,{children:"Learning curve for advanced analytics queries (KQL)"}),"\n",(0,i.jsx)(n.li,{children:"Data retention limits on different tiers"}),"\n",(0,i.jsx)(n.li,{children:"Vendor lock-in to Azure ecosystem"}),"\n",(0,i.jsx)(n.li,{children:"Limited customization compared to open-source alternatives"}),"\n",(0,i.jsx)(n.li,{children:"Sampling can miss important low-frequency events"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"cost-considerations",children:"Cost Considerations"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Pay-per-GB of data ingested (~$2.30/GB for first 5GB/month)"}),"\n",(0,i.jsx)(n.li,{children:"First 5GB per month included with many Azure services"}),"\n",(0,i.jsx)(n.li,{children:"Data retention: 90 days included, extended retention available"}),"\n",(0,i.jsx)(n.li,{children:"Additional costs for multi-step web tests and alerts"}),"\n",(0,i.jsx)(n.li,{children:"Enterprise features require higher-tier pricing"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"kusto-queries-for-analysis",children:"Kusto Queries for Analysis"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kusto",children:'// Performance analysis\r\nrequests\r\n| where timestamp > ago(1h)\r\n| summarize avg(duration), count() by name\r\n| order by avg_duration desc\r\n\r\n// Error analysis\r\nexceptions\r\n| where timestamp > ago(24h)\r\n| summarize count() by type, outerMessage\r\n| order by count_ desc\r\n\r\n// Custom business metrics\r\ncustomMetrics\r\n| where name == "BookingValue"\r\n| where timestamp > ago(7d)\r\n| summarize sum(value), avg(value) by bin(timestamp, 1h)\r\n| render timechart\r\n\r\n// User behavior analysis\r\ncustomEvents\r\n| where name == "UserAction"\r\n| where timestamp > ago(1d)\r\n| summarize count() by tostring(customDimensions["Action"])\r\n| order by count_ desc\r\n\r\n// Dependency performance\r\ndependencies\r\n| where timestamp > ago(1h)\r\n| summarize avg(duration), count(), successRate=avg(toint(success)) by name, type\r\n| order by avg_duration desc\n'})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}}}]);